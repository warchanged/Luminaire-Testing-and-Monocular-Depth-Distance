<!DOCTYPE html>
<html>

<head>
    <title>Gradio è¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }

        .test {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
        }

        pre {
            background: #f5f5f5;
            padding: 10px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h1>ğŸ” Gradio æœåŠ¡å™¨è¿æ¥æµ‹è¯•</h1>

    <div>
        <label>æœåŠ¡å™¨åœ°å€: </label>
        <input type="text" id="serverUrl" value="http://localhost:7860" style="width: 300px; padding: 8px;">
        <button onclick="runAllTests()">ğŸ§ª è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
    </div>

    <div id="results"></div>

    <script>
        async function addResult(title, content, isError = false) {
            const div = document.createElement('div');
            div.className = `test ${isError ? 'error' : 'success'}`;
            div.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
            document.getElementById('results').appendChild(div);
        }

        async function addInfo(title, content) {
            const div = document.createElement('div');
            div.className = 'test info';
            div.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
            document.getElementById('results').appendChild(div);
        }

        async function runAllTests() {
            document.getElementById('results').innerHTML = '';
            const serverUrl = document.getElementById('serverUrl').value;

            // æµ‹è¯•1: åŸºæœ¬è¿æ¥
            addInfo('æµ‹è¯• 1', 'æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯è®¿é—®...');
            try {
                const response = await fetch(serverUrl, { method: 'GET' });
                addResult('âœ… æµ‹è¯• 1: åŸºæœ¬è¿æ¥',
                    `çŠ¶æ€ç : ${response.status}\nå†…å®¹ç±»å‹: ${response.headers.get('content-type')}`);
            } catch (error) {
                addResult('âŒ æµ‹è¯• 1: åŸºæœ¬è¿æ¥å¤±è´¥', error.message, true);
                return; // å¦‚æœåŸºæœ¬è¿æ¥å¤±è´¥,åœæ­¢å…¶ä»–æµ‹è¯•
            }

            // æµ‹è¯•2: è·å– Gradio é…ç½®
            addInfo('æµ‹è¯• 2', 'è·å– Gradio API é…ç½®...');
            try {
                const response = await fetch(`${serverUrl}/config`, { method: 'GET' });
                const data = await response.json();
                addResult('âœ… æµ‹è¯• 2: API é…ç½®', JSON.stringify(data, null, 2).substring(0, 500) + '...');
            } catch (error) {
                addResult('âŒ æµ‹è¯• 2: API é…ç½®è·å–å¤±è´¥', error.message, true);
            }

            // æµ‹è¯•3: æ£€æŸ¥ä¸Šä¼ ç«¯ç‚¹
            addInfo('æµ‹è¯• 3', 'æµ‹è¯•æ–‡ä»¶ä¸Šä¼ ç«¯ç‚¹...');
            try {
                const blob = new Blob(['test'], { type: 'text/plain' });
                const formData = new FormData();
                formData.append('files', blob, 'test.txt');

                const response = await fetch(`${serverUrl}/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const data = await response.json();
                    addResult('âœ… æµ‹è¯• 3: æ–‡ä»¶ä¸Šä¼ ', JSON.stringify(data, null, 2));
                } else {
                    addResult('âŒ æµ‹è¯• 3: ä¸Šä¼ å¤±è´¥', `çŠ¶æ€ç : ${response.status}`, true);
                }
            } catch (error) {
                addResult('âŒ æµ‹è¯• 3: ä¸Šä¼ ç«¯ç‚¹é”™è¯¯', error.message, true);
            }

            // æµ‹è¯•4: æ£€æŸ¥å¯ç”¨çš„ API å‡½æ•°
            addInfo('æµ‹è¯• 4', 'æ£€æŸ¥å¯ç”¨çš„ API å‡½æ•°...');
            try {
                const response = await fetch(`${serverUrl}/config`, { method: 'GET' });
                const data = await response.json();

                if (data.dependencies) {
                    const functionNames = data.dependencies.map(d => d.targets ? d.targets.map(t => t[1]) : []).flat();
                    addResult('âœ… æµ‹è¯• 4: å¯ç”¨å‡½æ•°',
                        `å‘ç° ${functionNames.length} ä¸ªå‡½æ•°:\n${functionNames.join('\n')}`);
                } else {
                    addResult('âš ï¸ æµ‹è¯• 4: æœªæ‰¾åˆ°å‡½æ•°åˆ—è¡¨', 'é…ç½®ä¸­æ²¡æœ‰ dependencies å­—æ®µ', true);
                }
            } catch (error) {
                addResult('âŒ æµ‹è¯• 4: å‡½æ•°æ£€æŸ¥å¤±è´¥', error.message, true);
            }

            // æµ‹è¯•5: CORS æµ‹è¯•
            addInfo('æµ‹è¯• 5', 'æµ‹è¯• CORS è®¾ç½®...');
            try {
                const response = await fetch(`${serverUrl}/config`, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'POST'
                    }
                });

                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                    'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                    'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers')
                };

                addResult('âœ… æµ‹è¯• 5: CORS è®¾ç½®', JSON.stringify(corsHeaders, null, 2));
            } catch (error) {
                addResult('âŒ æµ‹è¯• 5: CORS æµ‹è¯•å¤±è´¥', error.message, true);
            }
        }
    </script>
</body>

</html>